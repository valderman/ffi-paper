\usepackage{float}
\usepackage{listings}
\usepackage[scaled]{beramono}

\makeatletter
\newcommand\fs@plainruled{\def\@fs@cfont{\rmfamily}\let\@fs@capt\floatc@plain%
  \def\@fs@pre{\hrule\kern2pt}%
  \def\@fs@mid{\kern2pt\hrule\vspace\abovecaptionskip\relax}%
  \def\@fs@post{}%
  \let\@fs@iftopcapt\iffalse}
\makeatother

\floatstyle{plainruled}

\newfloat{listingfloat}{tp}{lop}
\floatname{listingfloat}{\bf Figure}

\lstloadlanguages{Haskell}

\lstset{
    language=Haskell,
    keywords={where,let,in,if,then,else,case,of,do,type,data,class,instance,family
             ,newtype,deriving,import},
    otherkeywords={::},
    morecomment=[l]{--},
    literate=
        {>=}{{$\geq$}}2
        {<=}{{$\leq$}}2
        {\\}{{$\lambda$}}1
        {\\\\}{{\char`\\\char`\\}}1
        {->}{{$\rightarrow$}}2
        {<-}{{$\leftarrow$}}2
        {=>}{{$\Rightarrow$}}2
        {<>}{{$\circ$}}1
        {>>=}{{>>=}}3
        {>>}{{>{>}}}2
        {===>}{{$\Longrightarrow$}}3
        {|->}{{$\mapsto$}}2
        {/\\}{{$\cap$}}2
        {forall}{{$\forall$}}0
        {undefined}{{???}}3
        {_=()}{{$\ldots$}}3
        {OLD}{}0
        {NEW}{}0
        {BAD}{}0
        {Â¤}{}0
        {ZERO}{{$_{\text{0}}$}}1
        {ONE}{{$_{\text{1}}$}}1
        {TWO}{{$_{\text{2}}$}}1
        {THREE}{{$_{\text{3}}$}}1
        {FOUR}{{$_{\text{4}}$}}1
        {FIVE}{{$_{\text{5}}$}}1
        {_PLUS}{{$_+$}}1
        {_TRIANG}{{$_\triangle$}}1
        {_DIAMOND}{{$_\diamond$}}1
        {_FO}{{$_{\text{FO}}$}}2
        {_HO}{{$_{\text{HO}}$}}2
        {\\/}{{$\sqcup$}}2
        {prop_}{{$\forall$}}1
        {=id$}{{$.$}}1
        {_NS}{{$_{\text{NS}}$}}2
        {_SPEC}{{$_{\text{SPEC}}$}}3
        {_CIRC}{{$_{\text{CIRC}}$}}3
        {>>>>}{{$>$}}2
        {_CXT}{{$_{\text{CXT}}$}}3
        {PROOF}{}0
        {_V}{{$_\text{V}$}}1
        {_BV}{{$_\text{BV}$}}2
        {-->}{{$\longrightarrow$}}4
}

\ifbeamer
\else
  \lstnewenvironment{code}{\minipage{\linewidth}}{\endminipage}
    % Already set by Pandoc's default Beamer template. There doesn't seem to be a way to renew
    % listings environments. But this environment is only needed when using Pandoc with
    % `-t beamer+lhs`, so the solution is to use `-t beamer`.
\fi

\lstnewenvironment{codex}{\minipage{\linewidth}}{\endminipage}
\lstnewenvironment{ghci}{\minipage{\linewidth}\lstset{keywords={Main}}}{\endminipage}

%\lstnewenvironment{code}{\lstset{basicstyle=\fontsize{8}{10}\fontencoding{T1}\ttfamily}}{}
%\lstnewenvironment{codex}{\lstset{basicstyle=\fontsize{8}{10}\fontencoding{T1}\ttfamily}}{}
%\lstnewenvironment{ghci}{\lstset{basicstyle=\fontsize{8}{10}\fontencoding{T1}\ttfamily}\lstset{keywords={Main}}}{}
